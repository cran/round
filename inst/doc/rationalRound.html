<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Martin Mächler" />


<title>Exact Decimal Rounding via Rationals</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">

body {
background-color: #fff;
margin: 1em auto;
max-width: 1024px; 
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: left; 
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
}
pre {
overflow-x: auto; 

border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: white; 
border: #CCCCCC 1px solid; 
}

pre:not([class]) code {
color: #444;
background-color: white;
}
code {
font-family: Menlo, monospace; 
font-size: 90%; 
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img { 
background-color: #FFFFFF;
padding: 2px;

border-radius: 3px;
border: none; 
margin: 0 5px;
max-width: 100%; 
text-align: center; 
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: none; 
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: none; 
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: none; 
margin-left: 4px; 
font-size: 105%;
}
h5, h6 {
border-bottom: none; 
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Exact Decimal Rounding via Rationals</h1>
<h4 class="author">Martin Mächler</h4>
<h4 class="date">July 23, 2020; rendered on 2023-12-07</h4>



<div id="intro" class="section level2">
<h2>Intro</h2>
<p>As shown in the “basic” vignette <a href="https://CRAN.R-project.org/package=round/vignettes/Rounding.html">Rounding</a>
of package <code>round</code>, rounding to decimal digits of double
precision numbers is not trivial, mostly because most rational numbers
and even most rational numbers with a finite (small) number of decimal
digits are <em>not</em> exactly representable as regular (double
precision) numbers in R:</p>
<p>In communication with Steven Dirkse (@ GAMS), started on the R-devel
mailing lists, then continued in private, we came to concluding his own
proposal for <em>correct rounding</em> as the following, using the
definitions (as in <a href="https://CRAN.R-project.org/package=round/vignettes/Rounding.html">Rounding</a>),</p>
<p>Rounding to the nearest integer, <span class="math display">\[
\mathrm{round}(x) := r_0(x) := \mathrm{nearbyint}(x)
\]</span></p>
<p>and its generalization, rounding to <span class="math inline">\(d\)</span> digits, <span class="math display">\[
\mathrm{round}(x, d) := r_0(x \cdot 10^d) / 10^d
\]</span> for all integer <span class="math inline">\(d \in
\mathbb{Z}\)</span> (i.e., including negative <code>digits</code> <span class="math inline">\(d\)</span>).</p>
<ol style="list-style-type: decimal">
<li>all double precision numbers are rational mathematically, i.e.,
<span class="math inline">\(\in \mathbb{Q}\)</span>.</li>
<li><code>round(x, n)</code> as a mathematical function is well defined
unambigously on the rationals, i.e., for all <span class="math inline">\(x \in \mathbb{Q}\)</span> with the definitions
above.</li>
</ol>
<p>These two define <em>exact rounding</em> and he would want R to use
that.</p>
<p>In the following, I will use that, via exact arithmetic with rational
numbers via CRAN pkg <a href="https://CRAN.R-project.org/package=gmp">gmp</a> (which is based on
the free C library <code>GNU MP</code> aka <a href="https://gmplib.org/"><code>GMP</code></a>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">2</span>, .<span class="dv">3</span>, .<span class="dv">4</span>, .<span class="dv">5</span>, .<span class="dv">6</span>, .<span class="dv">7</span>, .<span class="dv">8</span>, .<span class="dv">9</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>fivers <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">d1 =</span>    .<span class="dv">5</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  , <span class="at">d2 =</span> <span class="fu">c</span>( .<span class="dv">05</span>, .<span class="dv">15</span>,  .<span class="dv">25</span>,  .<span class="dv">35</span>,  .<span class="dv">45</span>,  .<span class="dv">55</span>,  .<span class="dv">65</span>,  .<span class="dv">75</span>,  .<span class="dv">85</span>,  .<span class="dv">95</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  , <span class="at">d3 =</span> <span class="fu">c</span>(.<span class="dv">005</span>, .<span class="dv">015</span>, .<span class="dv">025</span>, .<span class="dv">035</span>, .<span class="dv">045</span>, .<span class="dv">055</span>, .<span class="dv">065</span>, .<span class="dv">075</span>, .<span class="dv">085</span>, .<span class="dv">095</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>           .<span class="dv">105</span>, .<span class="dv">115</span>, .<span class="dv">125</span>, .<span class="dv">135</span>, .<span class="dv">145</span>, .<span class="dv">155</span>, .<span class="dv">165</span>, .<span class="dv">175</span>, .<span class="dv">185</span>, .<span class="dv">195</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>           .<span class="dv">205</span>, .<span class="dv">215</span>, .<span class="dv">225</span>, .<span class="dv">235</span>, .<span class="dv">245</span>, .<span class="dv">255</span>, .<span class="dv">265</span>, .<span class="dv">275</span>, .<span class="dv">285</span>, .<span class="dv">295</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>           .<span class="dv">305</span>, .<span class="dv">315</span>, .<span class="dv">325</span>, .<span class="dv">335</span>, .<span class="dv">345</span>, .<span class="dv">355</span>, .<span class="dv">365</span>, .<span class="dv">375</span>, .<span class="dv">385</span>, .<span class="dv">395</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>           .<span class="dv">405</span>, .<span class="dv">415</span>, .<span class="dv">425</span>, .<span class="dv">435</span>, .<span class="dv">445</span>, .<span class="dv">455</span>, .<span class="dv">465</span>, .<span class="dv">475</span>, .<span class="dv">485</span>, .<span class="dv">495</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>           .<span class="dv">505</span>, .<span class="dv">515</span>, .<span class="dv">525</span>, .<span class="dv">535</span>, .<span class="dv">545</span>, .<span class="dv">555</span>, .<span class="dv">565</span>, .<span class="dv">575</span>, .<span class="dv">585</span>, .<span class="dv">595</span>,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>           .<span class="dv">605</span>, .<span class="dv">615</span>, .<span class="dv">625</span>, .<span class="dv">635</span>, .<span class="dv">645</span>, .<span class="dv">655</span>, .<span class="dv">665</span>, .<span class="dv">675</span>, .<span class="dv">685</span>, .<span class="dv">695</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>           .<span class="dv">705</span>, .<span class="dv">715</span>, .<span class="dv">725</span>, .<span class="dv">735</span>, .<span class="dv">745</span>, .<span class="dv">755</span>, .<span class="dv">765</span>, .<span class="dv">775</span>, .<span class="dv">785</span>, .<span class="dv">795</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>           .<span class="dv">805</span>, .<span class="dv">815</span>, .<span class="dv">825</span>, .<span class="dv">835</span>, .<span class="dv">845</span>, .<span class="dv">855</span>, .<span class="dv">865</span>, .<span class="dv">875</span>, .<span class="dv">885</span>, .<span class="dv">895</span>,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>           .<span class="dv">905</span>, .<span class="dv">915</span>, .<span class="dv">925</span>, .<span class="dv">935</span>, .<span class="dv">945</span>, .<span class="dv">955</span>, .<span class="dv">965</span>, .<span class="dv">975</span>, .<span class="dv">985</span>, .<span class="dv">995</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<p>Now, “obviously” (from what I wrote before), most of the decimal
fractions above are <em>not</em> exactly representable as double
precision numbers, but of course <em>are</em> representable as
fractions, concretely as ratios of (arbitrarily long aka <em>“big
num”</em>) integers:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(gmp)</span></code></pre></div>
<pre><code>## Loading required package: gmp</code></pre>
<pre><code>## 
## Attaching package: &#39;gmp&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     %*%, apply, crossprod, matrix, tcrossprod</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>q5er <span class="ot">&lt;-</span> <span class="fu">lapply</span>(fivers, as.bigq)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>q5er</span></code></pre></div>
<pre><code>## $d1
## Big Rational (&#39;bigq&#39;) :
## [1] 1/2
## 
## $d2
## Big Rational (&#39;bigq&#39;) object of length 10:
##  [1] 3602879701896397/72057594037927936 5404319552844595/36028797018963968
##  [3] 1/4                                3152519739159347/9007199254740992 
##  [5] 8106479329266893/18014398509481984 2476979795053773/4503599627370496 
##  [7] 5854679515581645/9007199254740992  3/4                               
##  [9] 7656119366529843/9007199254740992  4278419646001971/4503599627370496 
## 
## $d3
## Big Rational (&#39;bigq&#39;) object of length 100:
##   [1] 5764607523034235/1152921504606846976 1080863910568919/72057594037927936  
##   [3] 3602879701896397/144115188075855872  1261007895663739/36028797018963968  
##   [5] 3242591731706757/72057594037927936   7926335344172073/144115188075855872 
##   [7] 1170935903116329/18014398509481984   5404319552844595/72057594037927936  
##   [9] 6124895493223875/72057594037927936   3422735716801577/36028797018963968  
##  [11] 7566047373982433/72057594037927936   8286623314361713/72057594037927936  
##  [13] 1/8                                  607985949695017/4503599627370496    
##  [15] 5224175567749775/36028797018963968   5584463537939415/36028797018963968  
##  [17] 5944751508129055/36028797018963968   3152519739159347/18014398509481984  
##  [19] 3332663724254167/18014398509481984   3512807709348987/18014398509481984  
##  [21] 7385903388887613/36028797018963968   7746191359077253/36028797018963968  
##  [23] 8106479329266893/36028797018963968   2116691824864133/9007199254740992   
##  [25] 2206763817411543/9007199254740992    2296835809958953/9007199254740992   
##  [27] 2386907802506363/9007199254740992    2476979795053773/9007199254740992   
##  [29] 5134103575202365/18014398509481984   5314247560297185/18014398509481984  
##  [31] 5494391545392005/18014398509481984   5674535530486825/18014398509481984  
##  [33] 5854679515581645/18014398509481984   6034823500676465/18014398509481984  
##  [35] 1553741871442821/4503599627370496    799388933858263/2251799813685248    
##  [37] 1643813863990231/4503599627370496    3/8                                 
##  [39] 1733885856537641/4503599627370496    889460926405673/2251799813685248    
##  [41] 1823957849085051/4503599627370496    7475975381435023/18014398509481984  
##  [43] 7656119366529843/18014398509481984   7836263351624663/18014398509481984  
##  [45] 8016407336719483/18014398509481984   8196551321814303/18014398509481984  
##  [47] 8376695306909123/18014398509481984   4278419646001971/9007199254740992   
##  [49] 4368491638549381/9007199254740992    4458563631096791/9007199254740992   
##  [51] 4548635623644201/9007199254740992    4638707616191611/9007199254740992   
##  [53] 4728779608739021/9007199254740992    4818851601286431/9007199254740992   
##  [55] 4908923593833841/9007199254740992    4998995586381251/9007199254740992   
##  [57] 1272266894732165/2251799813685248    2589569785738035/4503599627370496   
##  [59] 658651445502935/1125899906842624     2679641778285445/4503599627370496   
##  [61] 1362338887279575/2251799813685248    2769713770832855/4503599627370496   
##  [63] 5/8                                  2859785763380265/4503599627370496   
##  [65] 1452410879826985/2251799813685248    2949857755927675/4503599627370496   
##  [67] 748723438050345/1125899906842624     3039929748475085/4503599627370496   
##  [69] 1542482872374395/2251799813685248    6260003482044989/9007199254740992   
##  [71] 6350075474592399/9007199254740992    6440147467139809/9007199254740992   
##  [73] 6530219459687219/9007199254740992    6620291452234629/9007199254740992   
##  [75] 6710363444782039/9007199254740992    6800435437329449/9007199254740992   
##  [77] 6890507429876859/9007199254740992    6980579422424269/9007199254740992   
##  [79] 7070651414971679/9007199254740992    7160723407519089/9007199254740992   
##  [81] 7250795400066499/9007199254740992    1835216848153477/2251799813685248   
##  [83] 3715469692580659/4503599627370496    940126422213591/1125899906842624    
##  [85] 3805541685128069/4503599627370496    1925288840700887/2251799813685248   
##  [87] 3895613677675479/4503599627370496    7/8                                 
##  [89] 3985685670222889/4503599627370496    2015360833248297/2251799813685248   
##  [91] 4075757662770299/4503599627370496    1030198414761001/1125899906842624   
##  [93] 4165829655317709/4503599627370496    2105432825795707/2251799813685248   
##  [95] 8511803295730237/9007199254740992    8601875288277647/9007199254740992   
##  [97] 8691947280825057/9007199254740992    8782019273372467/9007199254740992   
##  [99] 8872091265919877/9007199254740992    8962163258467287/9007199254740992</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.bigz</span>(<span class="dv">2</span>)<span class="sc">^</span><span class="dv">60</span> <span class="sc">==</span> <span class="fu">max</span>(<span class="fu">denominator</span>(q5er<span class="sc">$</span>d3))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Now the “exact rounding” has been available in CRAN package
<code>gmp</code> since Feb.2020, but in its first versions, we usee
“round up”, instead of <code>nearbyint()</code> which would <em>“round
to even”</em> as desired, as it is the IEEE default also adhered to by
itself. Only from <code>gmp</code> version 0.6-1 on (</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">print</span>(<span class="fu">packageVersion</span>(<span class="st">&quot;gmp&quot;</span>)) <span class="sc">&lt;</span> <span class="st">&quot;0.6-1&quot;</span>) {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="do">## From &#39;gmp&#39;s namespace, usually &quot;hidden&quot;, needed here :</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    is.whole.bigq  <span class="ot">&lt;-</span> gmp<span class="sc">:::</span>is.whole.bigq</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    biginteger_mod <span class="ot">&lt;-</span> gmp<span class="sc">:::</span>biginteger_mod</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    .mod.bigz <span class="ot">&lt;-</span> <span class="cf">function</span>(e1, e2) <span class="fu">.Call</span>(biginteger_mod, e1, e2)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">##&#39; rounding to integer a la &quot;nearbyint()&quot; -- i.e. &quot;round to even&quot;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  round0 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>      nU <span class="ot">&lt;-</span> <span class="fu">as.bigz.bigq</span>(xU <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="fu">as.bigq</span>(<span class="dv">1</span>, <span class="dv">2</span>)) <span class="co"># traditional round: .5 rounded up</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">any</span>(I <span class="ot">&lt;-</span> <span class="fu">is.whole.bigq</span>(xU))) { <span class="co"># I &lt;==&gt;  x == &lt;n&gt;.5 : &quot;hard case&quot;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>          I[I] <span class="ot">&lt;-</span> <span class="fu">.mod.bigz</span>(nU[I], 2L) <span class="sc">==</span> 1L <span class="co"># rounded up is odd  ==&gt; round *down*</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>          nU[I] <span class="ot">&lt;-</span> nU[I] <span class="sc">-</span> 1L</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>      nU</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  roundQ <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">digits =</span> <span class="dv">0</span>, <span class="at">r0 =</span> round0) {</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>      <span class="do">## round(x * 10^d) / 10^d</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>      p10 <span class="ot">&lt;-</span> <span class="fu">as.bigz</span>(<span class="dv">10</span>) <span class="sc">^</span> digits</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">r0</span>(x <span class="sc">*</span> p10) <span class="sc">/</span> p10</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">##&#39; round() method ==&gt;  arguments = (x, digits)</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  round.bigq <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">digits =</span> <span class="dv">0</span>) <span class="fu">roundQ</span>(x, digits)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">.S3method</span>(<span class="st">&quot;round&quot;</span>,<span class="st">&quot;bigq&quot;</span>, round.bigq)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="do">## all the above is part of gmp &gt;= 0.6-1 :</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">withAutoprint</span>({</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    round0</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    roundQ</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    gmp<span class="sc">:::</span>round.bigq</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  })</span></code></pre></div>
<pre><code>## [1] &#39;0.7.3&#39;
## &gt; round0
## function (x) 
## {
##     nU &lt;- as.bigz.bigq(xU &lt;- x + as.bigq(1, 2))
##     if (any(I &lt;- is.whole.bigq(xU))) {
##         I[I] &lt;- .mod.bigz(nU[I], 2L) == 1L
##         nU[I] &lt;- nU[I] - 1L
##     }
##     nU
## }
## &lt;bytecode: 0x4c04d30&gt;
## &lt;environment: namespace:gmp&gt;
## &gt; roundQ
## function (x, digits = 0, r0 = round0) 
## {
##     p10 &lt;- as.bigz(10)^digits
##     r0(x * p10)/p10
## }
## &lt;bytecode: 0x49b4348&gt;
## &lt;environment: namespace:gmp&gt;
## &gt; gmp:::round.bigq
## function (x, digits = 0) 
## roundQ(x, digits)
## &lt;bytecode: 0x4995960&gt;
## &lt;environment: namespace:gmp&gt;</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">## &quot;simple round&quot; was used in round.bigq() for several months in 2020:</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>round0s <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">as.bigz.bigq</span>(x <span class="sc">+</span> <span class="fu">as.bigq</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span></code></pre></div>
<p>Gives here</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(q5er<span class="sc">$</span>d2, <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Big Rational (&#39;bigq&#39;) object of length 10:
##  [1] 1/10 1/10 1/5  3/10 1/2  3/5  7/10 4/5  4/5  9/10</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(q5er<span class="sc">$</span>d3, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## Big Rational (&#39;bigq&#39;) object of length 100:
##   [1] 1/100  1/100  3/100  1/25   1/25   3/50   7/100  7/100  9/100  1/10  
##  [11] 1/10   3/25   3/25   7/50   7/50   3/20   17/100 17/100 9/50   1/5   
##  [21] 1/5    21/100 23/100 23/100 6/25   13/50  27/100 7/25   7/25   29/100
##  [31] 3/10   8/25   33/100 17/50  17/50  7/20   9/25   19/50  39/100 2/5   
##  [41] 41/100 41/100 21/50  43/100 9/20   23/50  47/100 47/100 12/25  49/100
##  [51] 51/100 13/25  53/100 27/50  11/20  14/25  14/25  57/100 29/50  59/100
##  [61] 3/5    61/100 31/50  16/25  13/20  33/50  67/100 17/25  69/100 69/100
##  [71] 7/10   71/100 18/25  73/100 37/50  19/25  77/100 39/50  79/100 4/5   
##  [81] 81/100 81/100 41/50  83/100 21/25  17/20  43/50  22/25  89/100 9/10  
##  [91] 91/100 23/25  93/100 47/50  47/50  19/20  24/25  97/100 49/50  99/100</code></pre>
<p>Now comparing these with all the <code>round()</code>ing methods from
our package <code>round</code>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(round)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>roundAllX <span class="ot">&lt;-</span> <span class="cf">function</span>(x, digits, <span class="at">versions =</span> roundVersions) {</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    xQ <span class="ot">&lt;-</span> <span class="fu">as.bigq</span>(x)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    M <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">roundAll</span>(x, digits, <span class="at">versions=</span>versions)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>             , <span class="at">SxctQ =</span> <span class="fu">asNumeric</span>(<span class="fu">roundQ</span>(xQ, digits, <span class="at">r0=</span>round0s))</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>             ,  <span class="at">xctQ =</span> <span class="fu">asNumeric</span>(<span class="fu">roundQ</span>(xQ, digits))</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>               )</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames</span>(M) <span class="ot">&lt;-</span> <span class="fu">format</span>(x)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    M</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>(rA1 <span class="ot">&lt;-</span> <span class="fu">roundAllX</span>(fivers<span class="sc">$</span>d2, <span class="dv">1</span>))</span></code></pre></div>
<pre><code>##      sprintf r0.C r1.C r1a.C r2.C r2a.C r3.C r3d.C  r3 SxctQ xctQ
## 0.05     0.1  0.0  0.0   0.0  0.0   0.0  0.0   0.0 0.0   0.1  0.1
## 0.15     0.1  0.2  0.2   0.2  0.2   0.2  0.1   0.1 0.1   0.1  0.1
## 0.25     0.2  0.2  0.2   0.2  0.2   0.2  0.2   0.2 0.2   0.3  0.2
## 0.35     0.3  0.4  0.4   0.4  0.4   0.4  0.3   0.3 0.3   0.3  0.3
## 0.45     0.5  0.4  0.4   0.4  0.4   0.4  0.4   0.4 0.4   0.5  0.5
## 0.55     0.6  0.6  0.6   0.6  0.6   0.6  0.6   0.6 0.6   0.6  0.6
## 0.65     0.7  0.6  0.6   0.6  0.6   0.6  0.7   0.7 0.7   0.7  0.7
## 0.75     0.8  0.8  0.8   0.8  0.8   0.8  0.8   0.8 0.8   0.8  0.8
## 0.85     0.8  0.8  0.8   0.8  0.8   0.8  0.8   0.8 0.8   0.8  0.8
## 0.95     0.9  1.0  1.0   1.0  1.0   1.0  0.9   0.9 0.9   0.9  0.9</code></pre>
<p>with some differences already, and more with <code>digits=2</code>
rounding:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>(rA2 <span class="ot">&lt;-</span> <span class="fu">roundAllX</span>(fivers<span class="sc">$</span>d3, <span class="dv">2</span>))</span></code></pre></div>
<pre><code>##       sprintf r0.C r1.C r1a.C r2.C r2a.C r3.C r3d.C   r3 SxctQ xctQ
## 0.005    0.01 0.00 0.00  0.00 0.00  0.00 0.00  0.00 0.00  0.01 0.01
## 0.015    0.01 0.02 0.02  0.02 0.02  0.02 0.01  0.01 0.01  0.01 0.01
## 0.025    0.03 0.02 0.02  0.02 0.02  0.02 0.03  0.03 0.03  0.03 0.03
## 0.035    0.04 0.04 0.04  0.04 0.04  0.04 0.04  0.04 0.04  0.04 0.04
## 0.045    0.04 0.04 0.04  0.04 0.04  0.04 0.04  0.04 0.04  0.04 0.04
## 0.055    0.06 0.06 0.06  0.06 0.06  0.06 0.06  0.06 0.06  0.06 0.06
## 0.065    0.07 0.06 0.06  0.06 0.06  0.06 0.06  0.06 0.06  0.07 0.07
## 0.075    0.07 0.08 0.08  0.08 0.08  0.08 0.07  0.07 0.07  0.07 0.07
## 0.085    0.09 0.08 0.08  0.08 0.08  0.08 0.09  0.09 0.09  0.09 0.09
## 0.095    0.10 0.10 0.10  0.10 0.10  0.10 0.10  0.10 0.10  0.10 0.10
## 0.105    0.10 0.10 0.10  0.10 0.10  0.10 0.10  0.10 0.10  0.10 0.10
## 0.115    0.12 0.12 0.12  0.12 0.12  0.12 0.12  0.12 0.12  0.12 0.12
## 0.125    0.12 0.12 0.12  0.12 0.12  0.12 0.12  0.12 0.12  0.13 0.12
## 0.135    0.14 0.14 0.14  0.14 0.14  0.14 0.14  0.14 0.14  0.14 0.14
## 0.145    0.14 0.14 0.14  0.14 0.14  0.14 0.14  0.14 0.14  0.14 0.14
## 0.155    0.15 0.16 0.16  0.16 0.16  0.16 0.16  0.16 0.16  0.15 0.15
## 0.165    0.17 0.16 0.16  0.16 0.16  0.16 0.16  0.16 0.16  0.17 0.17
## 0.175    0.17 0.18 0.18  0.18 0.18  0.18 0.17  0.17 0.17  0.17 0.17
## 0.185    0.18 0.18 0.18  0.18 0.18  0.18 0.18  0.18 0.18  0.18 0.18
## 0.195    0.20 0.20 0.20  0.20 0.20  0.20 0.20  0.20 0.20  0.20 0.20
## 0.205    0.20 0.20 0.20  0.20 0.20  0.20 0.20  0.20 0.20  0.20 0.20
## 0.215    0.21 0.22 0.22  0.22 0.22  0.22 0.22  0.22 0.22  0.21 0.21
## 0.225    0.23 0.22 0.22  0.22 0.22  0.22 0.22  0.22 0.22  0.23 0.23
## 0.235    0.23 0.24 0.24  0.24 0.24  0.24 0.23  0.23 0.23  0.23 0.23
## 0.245    0.24 0.24 0.24  0.24 0.24  0.24 0.24  0.24 0.24  0.24 0.24
## 0.255    0.26 0.26 0.26  0.26 0.26  0.26 0.26  0.26 0.26  0.26 0.26
## 0.265    0.27 0.26 0.26  0.26 0.26  0.26 0.26  0.26 0.26  0.27 0.27
## 0.275    0.28 0.28 0.28  0.28 0.28  0.28 0.28  0.28 0.28  0.28 0.28
## 0.285    0.28 0.28 0.28  0.28 0.28  0.28 0.28  0.28 0.28  0.28 0.28
## 0.295    0.29 0.30 0.30  0.30 0.30  0.30 0.30  0.30 0.30  0.29 0.29
## 0.305    0.30 0.30 0.30  0.30 0.30  0.30 0.30  0.30 0.30  0.30 0.30
## 0.315    0.32 0.32 0.32  0.32 0.32  0.32 0.32  0.32 0.32  0.32 0.32
## 0.325    0.33 0.32 0.32  0.32 0.32  0.32 0.32  0.32 0.32  0.33 0.33
## 0.335    0.34 0.34 0.34  0.34 0.34  0.34 0.34  0.34 0.34  0.34 0.34
## 0.345    0.34 0.34 0.34  0.34 0.34  0.34 0.34  0.34 0.34  0.34 0.34
## 0.355    0.35 0.36 0.36  0.36 0.36  0.36 0.36  0.36 0.36  0.35 0.35
## 0.365    0.36 0.36 0.36  0.36 0.36  0.36 0.36  0.36 0.36  0.36 0.36
## 0.375    0.38 0.38 0.38  0.38 0.38  0.38 0.38  0.38 0.38  0.38 0.38
## 0.385    0.39 0.38 0.38  0.38 0.38  0.38 0.38  0.38 0.38  0.39 0.39
## 0.395    0.40 0.40 0.40  0.40 0.40  0.40 0.40  0.40 0.40  0.40 0.40
## 0.405    0.41 0.40 0.40  0.40 0.40  0.40 0.41  0.41 0.41  0.41 0.41
## 0.415    0.41 0.42 0.42  0.42 0.42  0.42 0.42  0.42 0.42  0.41 0.41
## 0.425    0.42 0.42 0.42  0.42 0.42  0.42 0.42  0.42 0.42  0.42 0.42
## 0.435    0.43 0.44 0.44  0.44 0.44  0.44 0.44  0.44 0.44  0.43 0.43
## 0.445    0.45 0.44 0.44  0.44 0.44  0.44 0.44  0.44 0.44  0.45 0.45
## 0.455    0.46 0.46 0.46  0.46 0.46  0.46 0.46  0.46 0.46  0.46 0.46
## 0.465    0.47 0.46 0.46  0.46 0.46  0.46 0.47  0.47 0.47  0.47 0.47
## 0.475    0.47 0.48 0.48  0.48 0.48  0.48 0.48  0.48 0.48  0.47 0.47
## 0.485    0.48 0.48 0.48  0.48 0.48  0.48 0.48  0.48 0.48  0.48 0.48
## 0.495    0.49 0.50 0.50  0.50 0.50  0.50 0.50  0.50 0.50  0.49 0.49
## 0.505    0.51 0.50 0.50  0.50 0.50  0.50 0.50  0.50 0.50  0.51 0.51
## 0.515    0.52 0.52 0.52  0.52 0.52  0.52 0.52  0.52 0.52  0.52 0.52
## 0.525    0.53 0.52 0.52  0.52 0.52  0.52 0.52  0.52 0.52  0.53 0.53
## 0.535    0.54 0.54 0.54  0.54 0.54  0.54 0.54  0.54 0.54  0.54 0.54
## 0.545    0.55 0.55 0.55  0.55 0.55  0.55 0.54  0.54 0.54  0.55 0.55
## 0.555    0.56 0.56 0.56  0.56 0.56  0.56 0.56  0.56 0.56  0.56 0.56
## 0.565    0.56 0.56 0.56  0.56 0.56  0.56 0.56  0.56 0.56  0.56 0.56
## 0.575    0.57 0.57 0.57  0.57 0.57  0.57 0.58  0.58 0.58  0.57 0.57
## 0.585    0.58 0.58 0.58  0.58 0.58  0.58 0.58  0.58 0.58  0.58 0.58
## 0.595    0.59 0.60 0.60  0.60 0.60  0.60 0.60  0.60 0.60  0.59 0.59
## 0.605    0.60 0.60 0.60  0.60 0.60  0.60 0.60  0.60 0.60  0.60 0.60
## 0.615    0.61 0.62 0.62  0.62 0.62  0.62 0.62  0.62 0.62  0.61 0.61
## 0.625    0.62 0.62 0.62  0.62 0.62  0.62 0.62  0.62 0.62  0.63 0.62
## 0.635    0.64 0.64 0.64  0.64 0.64  0.64 0.64  0.64 0.64  0.64 0.64
## 0.645    0.65 0.64 0.64  0.64 0.64  0.64 0.64  0.64 0.64  0.65 0.65
## 0.655    0.66 0.66 0.66  0.66 0.66  0.66 0.66  0.66 0.66  0.66 0.66
## 0.665    0.67 0.66 0.66  0.66 0.66  0.66 0.66  0.66 0.66  0.67 0.67
## 0.675    0.68 0.68 0.68  0.68 0.68  0.68 0.68  0.68 0.68  0.68 0.68
## 0.685    0.69 0.68 0.68  0.68 0.68  0.68 0.69  0.69 0.69  0.69 0.69
## 0.695    0.69 0.70 0.70  0.70 0.70  0.70 0.70  0.70 0.70  0.69 0.69
## 0.705    0.70 0.70 0.70  0.70 0.70  0.70 0.70  0.70 0.70  0.70 0.70
## 0.715    0.71 0.72 0.72  0.72 0.72  0.72 0.72  0.72 0.72  0.71 0.71
## 0.725    0.72 0.72 0.72  0.72 0.72  0.72 0.72  0.72 0.72  0.72 0.72
## 0.735    0.73 0.74 0.74  0.74 0.74  0.74 0.74  0.74 0.74  0.73 0.73
## 0.745    0.74 0.74 0.74  0.74 0.74  0.74 0.74  0.74 0.74  0.74 0.74
## 0.755    0.76 0.76 0.76  0.76 0.76  0.76 0.76  0.76 0.76  0.76 0.76
## 0.765    0.77 0.76 0.76  0.76 0.76  0.76 0.76  0.76 0.76  0.77 0.77
## 0.775    0.78 0.78 0.78  0.78 0.78  0.78 0.78  0.78 0.78  0.78 0.78
## 0.785    0.79 0.78 0.78  0.78 0.78  0.78 0.78  0.78 0.78  0.79 0.79
## 0.795    0.80 0.80 0.80  0.80 0.80  0.80 0.80  0.80 0.80  0.80 0.80
## 0.805    0.81 0.80 0.80  0.80 0.80  0.80 0.80  0.80 0.80  0.81 0.81
## 0.815    0.81 0.82 0.82  0.82 0.82  0.82 0.81  0.81 0.81  0.81 0.81
## 0.825    0.82 0.82 0.82  0.82 0.82  0.82 0.82  0.82 0.82  0.82 0.82
## 0.835    0.83 0.84 0.84  0.84 0.84  0.84 0.84  0.84 0.84  0.83 0.83
## 0.845    0.84 0.84 0.84  0.84 0.84  0.84 0.84  0.84 0.84  0.84 0.84
## 0.855    0.85 0.86 0.86  0.86 0.86  0.86 0.86  0.86 0.86  0.85 0.85
## 0.865    0.86 0.86 0.86  0.86 0.86  0.86 0.86  0.86 0.86  0.86 0.86
## 0.875    0.88 0.88 0.88  0.88 0.88  0.88 0.88  0.88 0.88  0.88 0.88
## 0.885    0.89 0.88 0.88  0.88 0.88  0.88 0.88  0.88 0.88  0.89 0.89
## 0.895    0.90 0.90 0.90  0.90 0.90  0.90 0.90  0.90 0.90  0.90 0.90
## 0.905    0.91 0.90 0.90  0.90 0.90  0.90 0.90  0.90 0.90  0.91 0.91
## 0.915    0.92 0.92 0.92  0.92 0.92  0.92 0.92  0.92 0.92  0.92 0.92
## 0.925    0.93 0.92 0.92  0.92 0.92  0.92 0.92  0.92 0.92  0.93 0.93
## 0.935    0.94 0.94 0.94  0.94 0.94  0.94 0.94  0.94 0.94  0.94 0.94
## 0.945    0.94 0.94 0.94  0.94 0.94  0.94 0.94  0.94 0.94  0.94 0.94
## 0.955    0.95 0.96 0.96  0.96 0.96  0.96 0.96  0.96 0.96  0.95 0.95
## 0.965    0.96 0.96 0.96  0.96 0.96  0.96 0.96  0.96 0.96  0.96 0.96
## 0.975    0.97 0.98 0.98  0.98 0.98  0.98 0.98  0.98 0.98  0.97 0.97
## 0.985    0.98 0.98 0.98  0.98 0.98  0.98 0.98  0.98 0.98  0.98 0.98
## 0.995    0.99 1.00 1.00  1.00 1.00  1.00 1.00  1.00 1.00  0.99 0.99</code></pre>
<p>Not sure, if exact equality is the correct test here. We should
really check only if rounding <em>up</em> vs rounding <em>down</em>
happens in each case, but the rounded numbers may actually differ at by
a few bits (invisibly when printed by R!) :</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">symnum</span>(rA1 <span class="sc">==</span> rA1[,<span class="st">&quot;xctQ&quot;</span>])</span></code></pre></div>
<pre><code>##      s r0 r1.C r1a.C r2.C r2a.C r3.C r3d.C r3 S x
## 0.05 . .  .    .     .    .     .    .     .  | |
## 0.15 . .  .    .     .    .     .    .     .  | |
## 0.25 . .  .    .     .    .     .    .     .  . |
## 0.35 | .  .    .     .    .     |    |     |  | |
## 0.45 | .  .    .     .    .     .    .     .  | |
## 0.55 | |  |    |     |    |     |    |     |  | |
## 0.65 | .  .    .     .    .     |    |     |  | |
## 0.75 . .  .    .     .    .     .    .     .  | |
## 0.85 . .  .    .     .    .     .    .     .  | |
## 0.95 . .  .    .     .    .     .    .     .  | |</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">symnum</span>(rA2 <span class="sc">==</span> rA2[,<span class="st">&quot;xctQ&quot;</span>])</span></code></pre></div>
<pre><code>##       s r0 r1.C r1a.C r2.C r2a.C r3.C r3d.C r3 S x
## 0.005 . .  .    .     .    .     .    .     .  | |
## 0.015 . .  .    .     .    .     .    .     .  | |
## 0.025 | .  .    .     .    .     |    |     |  | |
## 0.035 . .  .    .     .    .     .    .     .  | |
## 0.045 . .  .    .     .    .     .    .     .  | |
## 0.055 | |  |    |     |    |     |    |     |  | |
## 0.065 . .  .    .     .    .     .    .     .  | |
## 0.075 . .  .    .     .    .     .    .     .  | |
## 0.085 | .  .    .     .    .     |    |     |  | |
## 0.095 . .  .    .     .    .     .    .     .  | |
## 0.105 . .  .    .     .    .     .    .     .  | |
## 0.115 | |  |    |     |    |     |    |     |  | |
## 0.125 | |  |    |     |    |     |    |     |  . |
## 0.135 . .  .    .     .    .     .    .     .  | |
## 0.145 . .  .    .     .    .     .    .     .  | |
## 0.155 | .  .    .     .    .     .    .     .  | |
## 0.165 . .  .    .     .    .     .    .     .  | |
## 0.175 . .  .    .     .    .     .    .     .  | |
## 0.185 | |  |    |     |    |     |    |     |  | |
## 0.195 . .  .    .     .    .     .    .     .  | |
## 0.205 . .  .    .     .    .     .    .     .  | |
## 0.215 | .  .    .     .    .     .    .     .  | |
## 0.225 . .  .    .     .    .     .    .     .  | |
## 0.235 . .  .    .     .    .     .    .     .  | |
## 0.245 | |  |    |     |    |     |    |     |  | |
## 0.255 . .  .    .     .    .     .    .     .  | |
## 0.265 . .  .    .     .    .     .    .     .  | |
## 0.275 . .  .    .     .    .     .    .     .  | |
## 0.285 . .  .    .     .    .     .    .     .  | |
## 0.295 | .  .    .     .    .     .    .     .  | |
## 0.305 | |  |    |     |    |     |    |     |  | |
## 0.315 . .  .    .     .    .     .    .     .  | |
## 0.325 . .  .    .     .    .     .    .     .  | |
## 0.335 . .  .    .     .    .     .    .     .  | |
## 0.345 . .  .    .     .    .     .    .     .  | |
## 0.355 | .  .    .     .    .     .    .     .  | |
## 0.365 | |  |    |     |    |     |    |     |  | |
## 0.375 . .  .    .     .    .     .    .     .  | |
## 0.385 . .  .    .     .    .     .    .     .  | |
## 0.395 . .  .    .     .    .     .    .     .  | |
## 0.405 | .  .    .     .    .     |    |     |  | |
## 0.415 | .  .    .     .    .     .    .     .  | |
## 0.425 | |  |    |     |    |     |    |     |  | |
## 0.435 | .  .    .     .    .     .    .     .  | |
## 0.445 . .  .    .     .    .     .    .     .  | |
## 0.455 . .  .    .     .    .     .    .     .  | |
## 0.465 | .  .    .     .    .     |    |     |  | |
## 0.475 | .  .    .     .    .     .    .     .  | |
## 0.485 | |  |    |     |    |     |    |     |  | |
## 0.495 | .  .    .     .    .     .    .     .  | |
## 0.505 . .  .    .     .    .     .    .     .  | |
## 0.515 . .  .    .     .    .     .    .     .  | |
## 0.525 . .  .    .     .    .     .    .     .  | |
## 0.535 . .  .    .     .    .     .    .     .  | |
## 0.545 . .  .    .     .    .     .    .     .  | |
## 0.555 . .  .    .     .    .     .    .     .  | |
## 0.565 . .  .    .     .    .     .    .     .  | |
## 0.575 | |  |    |     |    |     .    .     .  | |
## 0.585 | |  |    |     |    |     |    |     |  | |
## 0.595 | .  .    .     .    .     .    .     .  | |
## 0.605 | |  |    |     |    |     |    |     |  | |
## 0.615 | .  .    .     .    .     .    .     .  | |
## 0.625 | |  |    |     |    |     |    |     |  . |
## 0.635 . .  .    .     .    .     .    .     .  | |
## 0.645 . .  .    .     .    .     .    .     .  | |
## 0.655 . .  .    .     .    .     .    .     .  | |
## 0.665 . .  .    .     .    .     .    .     .  | |
## 0.675 . .  .    .     .    .     .    .     .  | |
## 0.685 | .  .    .     .    .     |    |     |  | |
## 0.695 | .  .    .     .    .     .    .     .  | |
## 0.705 | |  |    |     |    |     |    |     |  | |
## 0.715 | .  .    .     .    .     .    .     .  | |
## 0.725 | |  |    |     |    |     |    |     |  | |
## 0.735 | .  .    .     .    .     .    .     .  | |
## 0.745 | |  |    |     |    |     |    |     |  | |
## 0.755 . .  .    .     .    .     .    .     .  | |
## 0.765 . .  .    .     .    .     .    .     .  | |
## 0.775 . .  .    .     .    .     .    .     .  | |
## 0.785 . .  .    .     .    .     .    .     .  | |
## 0.795 . .  .    .     .    .     .    .     .  | |
## 0.805 . .  .    .     .    .     .    .     .  | |
## 0.815 . .  .    .     .    .     .    .     .  | |
## 0.825 | |  |    |     |    |     |    |     |  | |
## 0.835 | .  .    .     .    .     .    .     .  | |
## 0.845 | |  |    |     |    |     |    |     |  | |
## 0.855 | .  .    .     .    .     .    .     .  | |
## 0.865 | |  |    |     |    |     |    |     |  | |
## 0.875 . .  .    .     .    .     .    .     .  | |
## 0.885 . .  .    .     .    .     .    .     .  | |
## 0.895 . .  .    .     .    .     .    .     .  | |
## 0.905 . .  .    .     .    .     .    .     .  | |
## 0.915 . .  .    .     .    .     .    .     .  | |
## 0.925 . .  .    .     .    .     .    .     .  | |
## 0.935 | |  |    |     |    |     |    |     |  | |
## 0.945 | |  |    |     |    |     |    |     |  | |
## 0.955 | .  .    .     .    .     .    .     .  | |
## 0.965 | |  |    |     |    |     |    |     |  | |
## 0.975 | .  .    .     .    .     .    .     .  | |
## 0.985 | |  |    |     |    |     |    |     |  | |
## 0.995 | .  .    .     .    .     .    .     .  | |</code></pre>
<div id="session-information" class="section level3">
<h3>Session information</h3>
<p>(Note half a dozen non-standard packages present only as dependences
of <code>rmarkdown</code> we use for rendering this vignette)</p>
<pre><code>## R version 4.3.2 Patched (2023-12-01 r85659)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Fedora Linux 38 (Thirty Eight)
## 
## Matrix products: default
## BLAS:   /sfs/u/maechler/R/D/r-patched/F38-64-inst/lib/libRblas.so 
## LAPACK: /usr/lib64/liblapack.so.3.11.0
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] gmp_0.7-3      round_0.21-0.1
## 
## loaded via a namespace (and not attached):
##  [1] digest_0.6.33   R6_2.5.1        fastmap_1.1.1   xfun_0.41      
##  [5] cachem_1.0.8    knitr_1.45      htmltools_0.5.7 rmarkdown_2.25 
##  [9] lifecycle_1.0.4 cli_3.6.1       sass_0.4.8      jquerylib_0.1.4
## [13] compiler_4.3.2  tools_4.3.2     evaluate_0.23   bslib_0.6.1    
## [17] yaml_2.3.7      rlang_1.1.2     jsonlite_1.8.7</code></pre>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
